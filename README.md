# Парсер для скачивания бюллетеней по итогам торгов с сайта СПИМЭКС

Этот проект представляет собой парсер, который загружает бюллетени по итогам торгов с сайта СПИМЭКС, извлекает необходимые данные и сохраняет их в базе данных. Парсер ориентирован на данные из таблицы «Единица измерения: Метрическая тонна», где количество договоров больше нуля.

## Содержание

1. [Описание проекта](#описание-проекта)
2. [Требования](#требования)
3. [Установка](#установка)
4. [Использование](#использование)
5. [Структура базы данных](#структура-базы-данных)


## Описание проекта

Парсер выполняет следующие задачи:
- Скачивает бюллетени по итогам торгов с сайта [СПИМЭКС](https://spimex.com/markets/oil_products/trades/results/)
- Извлекает данные из таблицы «Единица измерения: Метрическая тонна», где по столбцу «Количество Договоров, шт.» значения больше 0
- Сохраняет полученные данные в таблицу `spimex_trading_results` в базе данных

## Требования

Для работы парсера необходимо установить следующие библиотеки Python:

- `requests` - для выполнения HTTP-запросов
- `beautifulsoup4` - для парсинга HTML
- `pandas` - для обработки данных
- `sqlalchemy` - для работы с базой данных
- `psycopg2`  - для хранения данных

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/valyaplotnikova/trading_parser.git
   cd trading_parser
   ```
2. Создайте виртуальное окружение и активируйте его:
```bash
   python -m venv venv
   source venv/bin/activate  # Для Linux/Mac
   venv\Scripts\activate  # Для Windows 
   ```

3. Установите зависимости:

```bash
   pip install -r requrements.txt
   ```
4. Заполните файл .env.sample своими данными и переименуйте его в .env    

5. Введите в терминале
```bash
psql -U your_user
CREATE DATABASE parser;
```
## Использование

 Запустите парсер для скачивания последнего бюллетеня торгов:

   ```bash
   python main.py
```
Или для заполнения базы данных данными торгов начиная с 01.01.2023:
   ```bash
   python complete_db.py
```
## Структура базы данных

Таблица `spimex_trading_results` имеет следующую структуру:

| Поле                   | Тип данных     | Описание                                         |
|------------------------|----------------|--------------------------------------------------|
| `id`                   | INTEGER        | Уникальный идентификатор записи                  |
| `exchange_product_id`  | TEXT           | Код Инструмента                                  |
| `exchange_product_name`| TEXT           | Наименование Инструмента                          |
| `oil_id`               | TEXT           | Первые 4 символа exchange_product_id            |
| `delivery_basis_id`    | TEXT           | Символы с 4 по 6 exchange_product_id            |
| `delivery_basis_name`  | TEXT           | Базис поставки                                   |
| `delivery_type_id`     | TEXT           | Последний символ exchange_product_id             |
| `volume`               | FLOAT          | Объем Договоров в единицах измерения            |
| `total`                | FLOAT          | Объем Договоров, руб.                            |
| `count`                | INTEGER        | Количество Договоров, шт.                        |
| `date`                 | DATE           | Дата торгов                                      |
| `created_on`           | TIMESTAMP      | Дата и время создания записи                     |
| `updated_on`           | TIMESTAMP      | Дата и время последнего обновления записи       |
